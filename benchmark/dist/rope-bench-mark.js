(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Div:()=>u,Img:()=>b,Input:()=>d,Link:()=>g,List:()=>p,Text:()=>m,VElement:()=>w,div:()=>y,hooks:()=>o,img:()=>E,input:()=>f,link:()=>C,list:()=>v,setProps:()=>h,special:()=>c,text:()=>k});class s{isRunning=!1;_renderMaxCount=1/0;_currentLoopCount=1/0;promise=null;taskMap=new Map;child=null;constructor(t,e){this.setMaxRenderCount(t),e instanceof Map?this.taskMap=e:e instanceof Array&&(this.taskMap=new Map(e))}add=(t,e,n,r)=>{if(this.isRunning)return this.child||(this.child=new s(this.renderMaxCount),this.child.parent=this),void this.child.add(t,e,n,r);{const s=this.taskMap.get(e);s?this.mergeContextTask(s,n):this.setContextTask({context:e,callback:r,task:t,updateObject:n}),this.start()}};mergeContextTask=(t,e)=>{e&&t.updateObject!==e&&t.updateObject&&Object.assign(t.updateObject,e)};setContextTask=({context:t,callback:e,task:s,updateObject:n})=>{e?this.taskMap.set(t,{callback:e,task:s,updateObject:n}):this.taskMap.set(t,s)};start=()=>{if(this.currentLoopCount>0){const{taskMap:t}=this,e=Array.from(t);this.currentLoopCount-=t.size,this.runTaskList(e),this.currentLoopCount!==1/0&&(this.resetTimer=setTimeout((()=>{this.currentLoopCount=this.renderMaxCount})))}else this.promise||this.runTaskCount(),this.promise=!0};runTaskCount=()=>{const t=Array.from(this.taskMap);this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=null),this.isRunning=!0;const e=t=>{const{renderMaxCount:s}=this,n=t.slice(0,s);this.runTaskList(n).then((()=>{if(s<t.length){const n=t.slice(s);this.runner((()=>e(n)))}else this.isRunning=!1,this.promise=null,this.currentLoopCount=this.renderMaxCount}))};e(t)};runTaskList=(t=[])=>{const e=Date.now();return new Promise(((s,n)=>{try{const n=t.length;for(let e=0;e<n;e++){const s=t[e],[n,r]=s,{callback:i,updateObject:a,task:l}=r;l(a),i instanceof Function&&i(),this.taskMap.delete(n)}s([n,Date.now()-e])}catch(t){return n(t)}}))};setMaxRenderCount=t=>{if(!t)return;const e=Number(t);isNaN(e)||(this.renderMaxCount=e)};onTaskFinished=t=>{};onTaskUpdate=t=>{};destroy=()=>{this.parent&&(this.parent.child=null),this.parent=null};clear=()=>{this.taskMap.clear(),this.destroy()};get renderMaxCount(){return this.parent?this.parent.renderMaxCount:this._renderMaxCount}set renderMaxCount(t){if(this.parent)return this.parent.renderMaxCount=t;this._currentLoopCount=t,this._renderMaxCount=t}get currentLoopCount(){return this._currentLoopCount}set currentLoopCount(t){this._currentLoopCount=t}get runner(){return window.requestIdleCallback?t=>{requestIdleCallback((()=>t()),{timeout:6})}:window.queueMicrotask?t=>{queueMicrotask((()=>{queueMicrotask((()=>t()))}))}:window.requestAnimationFrame?t=>requestAnimationFrame((()=>t())):window.setTimeout?t=>setTimeout((()=>t())):void 0}}const n=s,r={};window.i=[];class i{static EVENT={onClick:"onclick",onInput:"oninput",onChange:"onchange"};static getPropsSafe=(t,e,s)=>{try{const n=e.split(".").reduce(((t,e)=>t[e]),t);return void 0===n?n===s?n:s:n}catch{return s}};static setAttribute=function(t,...e){const s=[...e],n=s.length;if(1===n&&void 0!==s[0]&&(this.props[t]=s[0]),n>=2&&this.bind(...s,this.props,t,s[2]),!this.dynamicProps.includes(t))return this.dynamicProps.push(t),void this.render.initDynamicProps([t])};props={children:[],style:{}};events={};dynamicProps=[];children=t=>(t?.length&&t.forEach((t=>{t.parent=this,this.props.children.push(t),t.update()})),this);className=(...t)=>(this.setAttribute("className",...t),this);class=this.className;dispose=(...t)=>(this.setAttribute("dispose",...t),this);id=(...t)=>(this.setAttribute("id",...t),this);style=(...t)=>(this.setAttribute("style",...t),this);key=(...t)=>(this.setAttribute("key",...t),this);show=(...t)=>(this.setAttribute("show",...t),this);setAttribute=i.setAttribute.bind(this);bind=(...t)=>{const e=[...t],s=(t,e,s,n,r)=>{Rope.detective.registe(t,e,n,this),Object.defineProperty(s,n,{get(){const s=i.getPropsSafe(t,e);return r instanceof Function?r(s):s}})};if(5===e.length){const[t,n,r,i,a]=e;s(t,n,r,i,a)}if(6===e.length){const[t,n,r,i,a,l]=e;s(t,n,i,a,l)}};onClick=t=>(this.element[i.EVENT.onClick]=t,this);onInput=t=>(this.element[i.EVENT.onInput]=t,this);onChange=t=>(this.element[i.EVENT.onChange]=t,this);onMounted=t=>(this.mountedCallback=t,this);onUpdated=t=>(this.updatedCallback=t,this);onEvent=(t,e)=>t&&e?(this.element[t]=e,this):this;update=(t,e)=>{if(this.renderTask)return this.renderTask;this.renderTask=new Promise((s=>{queueMicrotask((()=>{Rope.renderTask.add(this.render.render,this,t,(()=>{this.renderTask=null,e instanceof Function&&e(),this.updatedCallback instanceof Function&&this.updatedCallback(this),s()}))}))}))};dom=(t=(()=>null))=>(t(this.element,!!this.element.parentElement),this);setElement=t=>(t instanceof HTMLElement&&(this.element=t),this);get templateElement(){return this._templateElement}set templateElement(t){this._templateElement=t}get element(){return this._el||(this._el=document.createElement(this.type)),this._el}set element(t){return this._el=t}get parent(){return this._parent?this._parent:this.element.parentElement?{element:this.element.parentElement}:this.templateElement?.parentElement?{element:this.templateElement.parentElement}:this._parent}set parent(t){this._parent=t}get render(){return this._render||(this._render=new class{target=null;dynamicProps=["show"];renderedAttributes=[];sort=Object.create(null);constructor(t,e=[]){this.target=t,this.initDynamicProps(e)}initDynamicProps=t=>{t.forEach(((t,e)=>{this.dynamicProps.includes(t)||this.dynamicProps.push(t),this.sort[t]=e}))};render=t=>{const e=t?this.objectToList(t):this.dynamicProps;this.__render(e),this.renderedAttributes?.length&&(this.__render(this.renderedAttributes),this.renderedAttributes=[])};objectToList=t=>{const e=[];return Object.keys(t).forEach((t=>{const s=this.sort[t];e[s]=t})),e};__render=t=>{if(t?.length){let e=null;t.find(((t,s)=>{const n=this[t];if(n){const r=n();if(window.i.push(`${this.target.type}:${t}`),!1===r)return e=s,!0}return!1}))&&(this.renderedAttributes=t.slice(e+1))}};dispose=()=>{const{dispose:t}=this.props;return!t||(this.clearElement(),this.clearState(),!1)};show=()=>{const{show:t}=this.props;return!1===t?(this.resumeTemplate(),!1):(this.resumeElement(),!0)};key=()=>{const{key:t}=this.props,{element:e}=this;return e&&void 0!==t&&null!=t&&(r[t]=e),!0};className=()=>{const{className:t}=this.props;return this.setStringAttribute("class",t),!0};id=()=>{const{id:t}=this.props;return this.setStringAttribute("id",t),!0};style=()=>{const{element:t}=this,{style:e}=this.props;return Object.entries(e).forEach((e=>{const[s,n]=e;t.style[s]!==n&&(t.style[s]=n)})),!0};src=()=>{const{src:t}=this.props;return this.setStringAttribute("src",t),!0};href=()=>{const{href:t}=this.props;return this.setStringAttribute("href",t),!0};value=()=>{const{value:t}=this.props;if(null==t)return!0;const e=String(t),s="input"===this.type?"value":"innerHTML";return this.element[s]!==e&&(this.element[s]=e),!0};resumeTemplate=()=>{const{element:t,parent:e}=this,s=e.element,n=this.templateElement||document.createComment("");return!(s&&(n.parentElement||t.parentElement||!s?t.parentElement&&!n.parentElement&&(t.parentElement.insertBefore(n,t),t.remove(),0):(s.appendChild(n),this.templateElement||(this.templateElement=n),0)))};resumeElement=()=>{const{parent:t}=this;return!t||(this.templateElement?.parentElement?(this.templateElement.parentElement.insertBefore(this.element,this.templateElement),this.templateElement.remove(),!0):(t.element.appendChild(this.element),!0))};removeAllElement=()=>{const{element:t,templateElement:e}=this;return t&&t.remove(),e&&e.remove(),!0};clearAllElement=()=>(this.removeElement(),this.element=null,this.templateElement=null,!0);clearElement=()=>(this.resumeTemplate(),this.element=null,!0);clearState=()=>{this.hook.clearState()};setStringAttribute=(t,e)=>{const{element:s}=this;if(s&&null!=t&&"string"==typeof t)if(null!=e&&""!==e){const n=s.getAttribute(t),r=String(e);n!==r&&s.setAttribute(t,r)}else s.removeAttribute(t)};get element(){return this.target.element}set element(t){this.target.element=t}get templateElement(){return this.target.templateElement}set templateElement(t){this.target.templateElement=t}get hook(){return this.target.hook}get props(){return this.target.props}get parent(){return this.target.parent}get type(){return this.target.type}get mountedCallback(){return this.target.mountedCallback}}(this,this.dynamicProps)),this._render}}const a=i;class l{type="hook";constructor(t,e){this.state=t,this.vm=e,e.hook=this}clearState=()=>{for(let t in this.state)delete this.state[t]};get element(){return this.vm.element}get props(){return this.vm.props}}const o=(t,e)=>{let s=(t=>t instanceof Function?t()||Object.create(null):null==t?{}:t)(e),n={},r=null;return(...e)=>{let i="normal",a={};const o=[...e];1!==o.length||o[0]?.vm||(a=o[0]);const[c,h]=o;"object"==typeof c&&"string"==typeof h&&(i="dynamic");const u=(t,e)=>new Promise(((i,a)=>{try{if(!t&&"object"==typeof t)return a("changeState is not defined!");if(Object.assign(n,t),r)return;r=!0,queueMicrotask((()=>{Object.assign(s,n),Rope.detective.dispatch(s,n,((...t)=>{e&&e instanceof Function&&e(...t),i()})),r=null,n={}}))}catch(t){a(t)}}));let p;switch(i){case"normal":p=t(a,s,u);break;case"dynamic":p=t(...e,s,u)}return new l(s,p),p}},c=function(t,...e){return this.setAttribute(t,...e),this},h=({args:t,Type:e})=>{const s=t,n=s.length;if(3===n){const[t,n,r]=s;return new e(t,n,r)}if(2===n){const[t,n]=s;return new e(t,n)}if(1===n){const[t]=s;return new e(t)}};class u extends a{type="div";constructor(...t){super(),t[0]?.type&&this.children(t)}value=c.bind(this,"value")}class p extends a{itemRender=null;type="ul";renderCount=1/0;constructor(t,...e){super(),this.itemRender=t,this.list(...e),this.render.list=this.updateList}list=(...t)=>c.call(this,"list",...t);updateList=()=>{const{children:t,list:e}=this.props;if(Rope.detective.dispatch(this,{props:{list:!0}}),e.length>t.length){const s=t.length,n=e.slice(s);this.addListChildren(n,s)}};addListChildren=(t,e)=>{const{itemRender:s}=this;if(this.renderCount!==1/0);else{const n=t.map(((t,n)=>{const r=n+e;return s(t,r).show(this,"props.list",((t=[])=>r<t.length))}));this.children(n)}};setRenderCount=t=>(this.renderCount=t,this)}class d extends a{type="input";constructor(...t){super(),this.value(...t)}value=c.bind(this,"value")}class m extends a{type="span";constructor(...t){super(),this.value(...t)}value=c.bind(this,"value")}class b extends a{type="img";constructor(...t){super(),this.src(...t)}src=c.bind(this,"src")}class g extends a{type="a";constructor(...t){super(),this.href(...t)}href=c.bind(this,"href");value=c.bind(this,"value")}const y=(...t)=>t instanceof Array&&!(t[1]instanceof Array)?new u(...t):new u(t[0]),k=(...t)=>h({args:[...t],Type:m}),f=(...t)=>h({args:[...t],Type:d}),E=(...t)=>h({args:[...t],Type:b}),C=(...t)=>h({args:[...t],Type:g}),v=(...t)=>h({args:[...t],Type:p}),w=a,T=new n,M=new class{memo=new Map;registe=(t,e,s,n)=>{const r=this.memo.get(t);if(r){const t=r.get(n);if(t)t[s]=e;else{const t=Object.create(null);t[s]=e,r.set(n,t)}}else{const r=new Map;this.memo.set(t,r);const i=Object.create(null);i[s]=e,r.set(n,i)}};dispatch=(t,e,s)=>{const n=this.memo.get(t);n&&n.forEach(((t,n)=>{Object.keys(t).find((s=>void 0!==Rope.Element.VElement.getPropsSafe(e,t[s])))&&n.update(t,s)}))}};class x{static renderTask=T;static detective=M;static Element=Object.create(null);constructor(t){x.renderTask.setMaxRenderCount(t)}}Object.assign(x.Element,e),(globalThis||window||GLOBAL).Rope=x;const A=x,{special:j,VElement:_}=Rope.Element;class L extends _{type="tr";dynamicProps=["value"];constructor(...t){super(),t&&t[0]?.type&&this.children(t)}value=j.bind(this,"value")}class O extends _{type="td";dynamicProps=["value"];constructor(...t){super(),t&&t[0]?.type&&this.children(t)}value=j.bind(this,"value")}const P=(...t)=>new O(...t),{hooks:S}=Rope.Element,R={state:{list:[],selected:null},props:{}},q=S(((t,e,s)=>s),R.state)(R.props),{div:N,text:F}=Rope.Element,I=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],V=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],$=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];let D=1;function z(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]={id:D++,label:`${I[B(I.length)]} ${V[B(V.length)]} ${$[B($.length)]}`};return e}function B(t){return Math.round(1e3*Math.random())%t}const H=({id:t})=>N(F(t).class("btn btn-primary btn-block").setElement(document.createElement("button")).id(t).onClick((()=>(t=>{switch(window.i=[],t){case"run":q({list:z(1e3)});break;case"runlots":q({list:z(1e4)});break;case"add":q({list:R.state.list.concat(z(1e3))});break;case"update":{const t=R.state.list.slice(0);for(let e=0;e<t.length;e+=10){const s=t[e];t[e]={id:s.id,label:s.label+" !!!"}}q({list:t});break}case"clear":q({list:[]});break;case"swaprows":{const{list:t}=R.state;q({list:[t[0],t[998],...t.slice(2,998),t[1],t[999]]});break}}})(t)))).class("col-sm-6 smallpad"),U=N(H({id:"run"}),H({id:"runlots"}),H({id:"add"}),H({id:"update"}),H({id:"clear"}),H({id:"swaprows"})).class("row");U.update(),document.querySelector("#button-container").appendChild(U.element);const{text:G,link:J,list:K}=A.Element,Q=K(((t,e)=>((...t)=>new L(...t))(P().class("col-md-1").value(R.state,`list.${e}.id`),P(J("").value(R.state,`list.${e}.label`).onClick((()=>{return t=R.state.list[e].id,void q({selected:t});var t}))).class("col-md-4"),P(J("").children([G("").class("glyphicon glyphicon-remove")]).onClick((()=>(t=>{R.state.list.splice(t,1),q(R.state)})(e)))).class("col-md-1"),P().class("col-md-6")).class(R.state,"selected",(t=>{const s=R.state.list[e];return s&&s.id===t?"danger":""}))),R.state,"list").setElement(document.createElement("tbody"));Q.update(),document.querySelector("#list-container").appendChild(Q.element)})();