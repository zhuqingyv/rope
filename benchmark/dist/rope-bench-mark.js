(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Div:()=>u,Img:()=>b,Input:()=>d,Link:()=>g,List:()=>p,Text:()=>m,VElement:()=>T,div:()=>k,hooks:()=>o,img:()=>E,input:()=>f,link:()=>C,list:()=>v,setProps:()=>h,special:()=>c,text:()=>y});class s{isRunning=!1;_renderMaxCount=1/0;_currentLoopCount=1/0;promise=null;taskMap=new Map;child=null;constructor(e,t){this.setMaxRenderCount(e),t instanceof Map?this.taskMap=t:t instanceof Array&&(this.taskMap=new Map(t))}add=(e,t,n,r)=>{if(this.isRunning)return this.child||(this.child=new s(this.renderMaxCount),this.child.parent=this),void this.child.add(e,t,n,r);{const s=this.taskMap.get(t);s?this.mergeContextTask(s,n):this.setContextTask({context:t,callback:r,task:e,updateObject:n}),this.start()}};mergeContextTask=(e,t)=>{t&&e.updateObject!==t&&e.updateObject&&Object.assign(e.updateObject,t)};setContextTask=({context:e,callback:t,task:s,updateObject:n})=>{t?this.taskMap.set(e,{callback:t,task:s,updateObject:n}):this.taskMap.set(e,s)};start=()=>{if(this.currentLoopCount>0){const{taskMap:e}=this,t=Array.from(e);this.currentLoopCount-=e.size,this.runTaskList(t),this.currentLoopCount!==1/0&&(this.resetTimer=setTimeout((()=>{this.currentLoopCount=this.renderMaxCount})))}else this.promise||this.runTaskCount(),this.promise=!0};runTaskCount=()=>{const e=Array.from(this.taskMap);this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=null),this.isRunning=!0;const t=e=>{const{renderMaxCount:s}=this,n=e.slice(0,s);this.runTaskList(n).then((()=>{if(s<e.length){const n=e.slice(s);this.runner((()=>t(n)))}else this.isRunning=!1,this.promise=null,this.currentLoopCount=this.renderMaxCount}))};this.taskMap.clear(),t(e)};runTaskList=(e=[])=>{const t=Date.now();return new Promise(((s,n)=>{try{const n=e.length;for(let t=0;t<n;t++){const s=e[t],[n,r]=s,{callback:i,updateObject:a,task:l}=r;l(a),i instanceof Function&&i()}s([n,Date.now()-t])}catch(e){return n(e)}}))};setMaxRenderCount=e=>{if(!e)return;const t=Number(e);isNaN(t)||(this.renderMaxCount=t)};onTaskFinished=e=>{};onTaskUpdate=e=>{};destroy=()=>{this.parent&&(this.parent.child=null),this.parent=null};clear=()=>{this.taskMap.clear(),this.destroy()};get renderMaxCount(){return this.parent?this.parent.renderMaxCount:this._renderMaxCount}set renderMaxCount(e){if(this.parent)return this.parent.renderMaxCount=e;this._currentLoopCount=e,this._renderMaxCount=e}get currentLoopCount(){return this._currentLoopCount}set currentLoopCount(e){this._currentLoopCount=e}get runner(){return window.requestIdleCallback?e=>{requestIdleCallback((()=>e()),{timeout:6})}:window.queueMicrotask?e=>{queueMicrotask((()=>{queueMicrotask((()=>e()))}))}:window.requestAnimationFrame?e=>requestAnimationFrame((()=>e())):window.setTimeout?e=>setTimeout((()=>e())):void 0}}const n=s,r={};class i{static EVENT={onClick:"onclick",onInput:"oninput",onChange:"onchange"};static getPropsSafe=(e,t,s)=>{try{const n=t.split(".").reduce(((e,t)=>e[t]),e);return void 0===n?n===s?n:s:n}catch{return s}};static setAttribute=function(e,...t){const s=[...t],n=s.length;if(1===n&&void 0!==s[0]&&(this.props[e]=s[0]),n>=2&&this.bind(...s,this.props,e,s[2]),!this.dynamicProps.includes(e))return this.dynamicProps.push(e),void this.render.initDynamicProps([e])};props={children:[],style:{}};events={};dynamicProps=[];children=e=>{if(e?.length){const t=e.map((e=>(e.parent=this,this.props.children.push(e),e.element)));this.element.append(...t)}return this};className=(...e)=>(this.setAttribute("className",...e),this);class=this.className;dispose=(...e)=>(this.setAttribute("dispose",...e),this);id=(...e)=>(this.setAttribute("id",...e),this);style=(...e)=>(this.setAttribute("style",...e),this);key=(...e)=>(this.setAttribute("key",...e),this);show=(...e)=>(this.setAttribute("show",...e),this);setAttribute=i.setAttribute.bind(this);bind=(...e)=>{const t=[...e],s=(e,t,s,n,r)=>{A.detective.registe(e,t,n,this),Object.defineProperty(s,n,{get(){const s=i.getPropsSafe(e,t);return r instanceof Function?r(s):s}})};if(5===t.length){const[e,n,r,i,a]=t;s(e,n,r,i,a)}if(6===t.length){const[e,n,r,i,a,l]=t;s(e,n,i,a,l)}};onClick=e=>(this.element[i.EVENT.onClick]=e,this);onInput=e=>(this.element[i.EVENT.onInput]=e,this);onChange=e=>(this.element[i.EVENT.onChange]=e,this);onMounted=e=>(this.mountedCallback=e,this);onUpdated=e=>(this.updatedCallback=e,this);onEvent=(e,t)=>e&&t?(this.element[e]=t,this):this;update=(e,t)=>A.renderTask.renderMaxCount===1/0?(this.render.render(e),this.renderTask=null,t instanceof Function&&t(),void(this.updatedCallback instanceof Function&&this.updatedCallback(this))):this.renderTask?this.renderTask:(this.renderTask=!0,void queueMicrotask((()=>{A.renderTask.renderMaxCount===1/0?(this.render.render(e),this.renderTask=null,t instanceof Function&&t(),this.updatedCallback instanceof Function&&this.updatedCallback(this)):A.renderTask.add(this.render.render,this,e,(()=>{this.renderTask=null,t instanceof Function&&t(),this.updatedCallback instanceof Function&&this.updatedCallback(this)}))})));dom=(e=(()=>null))=>(e(this.element,!!this.element.parentElement),this);setElement=e=>(e instanceof HTMLElement&&(this.element=e),this);get templateElement(){return this._templateElement}set templateElement(e){this._templateElement=e}get element(){return this._el||(this._el=document.createElement(this.type)),this._el}set element(e){return this._el=e}get parent(){return this._parent?this._parent:this.element.parentElement?{element:this.element.parentElement}:this.templateElement?.parentElement?{element:this.templateElement.parentElement}:this._parent}set parent(e){this._parent=e,this.update()}get render(){return this._render||(this._render=new class{target=null;dynamicProps=["show"];renderedAttributes=[];sort=Object.create(null);constructor(e,t=[]){this.target=e,this.initDynamicProps(t)}initDynamicProps=e=>{e.forEach(((e,t)=>{this.dynamicProps.includes(e)||this.dynamicProps.push(e),this.sort[e]=t}))};render=e=>{const t=e?this.objectToList(e):this.dynamicProps;this.__render(t),this.renderedAttributes?.length&&(this.__render(this.renderedAttributes),this.renderedAttributes=[])};objectToList=e=>{const t=[];return Object.keys(e).forEach((e=>{const s=this.sort[e];t[s]=e})),t};__render=e=>{if(e?.length){let t=null;e.find(((e,s)=>{const n=this[e];return!(!n||!1!==n()||(t=s,0))}))&&(this.renderedAttributes=e.slice(t+1))}};dispose=()=>{const{dispose:e}=this.props;return!e||(this.clearElement(),this.clearState(),!1)};show=()=>{const{show:e}=this.props;return!1===e?(this.resumeTemplate(),!1):(this.resumeElement(),!0)};key=()=>{const{key:e}=this.props,{element:t}=this;return t&&void 0!==e&&null!=e&&(r[e]=t),!0};className=()=>{const{className:e}=this.props;return this.setStringAttribute("class",e),!0};id=()=>{const{id:e}=this.props;return this.setStringAttribute("id",e),!0};style=()=>{const{element:e}=this,{style:t}=this.props;return Object.entries(t).forEach((t=>{const[s,n]=t;e.style[s]!==n&&(e.style[s]=n)})),!0};src=()=>{const{src:e}=this.props;return this.setStringAttribute("src",e),!0};href=()=>{const{href:e}=this.props;return this.setStringAttribute("href",e),!0};value=()=>{const{value:e}=this.props;if(null==e)return!0;const t=String(e),s="input"===this.type?"value":"innerHTML";return this.element[s]!==t&&(this.element[s]=t),!0};resumeTemplate=()=>{const{element:e,parent:t}=this,s=t.element,n=this.templateElement||document.createComment("");return!(s&&(n.parentElement||e.parentElement||!s?e.parentElement&&!n.parentElement&&(e.parentElement.insertBefore(n,e),e.remove(),0):(s.appendChild(n),this.templateElement||(this.templateElement=n),0)))};resumeElement=()=>{const{parent:e}=this;return!(e&&!this.element.parentElement&&(this.templateElement?.parentElement?(this.templateElement.parentElement.insertBefore(this.element,this.templateElement),this.templateElement.remove(),0):(e.element.appendChild(this.element),0)))};removeAllElement=()=>{const{element:e,templateElement:t}=this;return e&&e.remove(),t&&t.remove(),!0};clearAllElement=()=>(this.removeElement(),this.element=null,this.templateElement=null,!0);clearElement=()=>(this.resumeTemplate(),this.element=null,!0);clearState=()=>{this.hook.clearState()};setStringAttribute=(e,t)=>{const{element:s}=this;if(s&&null!=e&&"string"==typeof e)if(null!=t&&""!==t){const n=s.getAttribute(e),r=String(t);n!==r&&s.setAttribute(e,r)}else s.removeAttribute(e)};get element(){return this.target.element}set element(e){this.target.element=e}get templateElement(){return this.target.templateElement}set templateElement(e){this.target.templateElement=e}get hook(){return this.target.hook}get props(){return this.target.props}get parent(){return this.target.parent}get type(){return this.target.type}get mountedCallback(){return this.target.mountedCallback}}(this,this.dynamicProps)),this._render}}const a=i;class l{type="hook";constructor(e,t){this.state=e,this.vm=t,t.hook=this}clearState=()=>{for(let e in this.state)delete this.state[e]};get element(){return this.vm.element}get props(){return this.vm.props}}const o=(e,t)=>{let s=(e=>e instanceof Function?e()||Object.create(null):null==e?{}:e)(t),n={},r=null;return(...t)=>{let i="normal",a={};const o=[...t];1!==o.length||o[0]?.vm||(a=o[0]);const[c,h]=o;"object"==typeof c&&"string"==typeof h&&(i="dynamic");const u=(e,t)=>new Promise(((i,a)=>{try{if(!e&&"object"==typeof e)return a("changeState is not defined!");if(Object.assign(n,e),r)return;r=!0,queueMicrotask((()=>{Object.assign(s,n),Rope.detective.dispatch(s,n,((...e)=>{t&&t instanceof Function&&t(...e),i()})),r=null,n={}}))}catch(e){a(e)}}));let p;switch(i){case"normal":p=e(a,s,u);break;case"dynamic":p=e(...t,s,u)}return new l(s,p),p}},c=function(e,...t){return this.setAttribute(e,...t),this},h=({args:e,Type:t})=>{const s=e,n=s.length;if(3===n){const[e,n,r]=s;return new t(e,n,r)}if(2===n){const[e,n]=s;return new t(e,n)}if(1===n){const[e]=s;return new t(e)}};class u extends a{type="div";constructor(...e){super(),e[0]?.type&&this.children(e)}value=c.bind(this,"value")}class p extends a{itemRender=null;type="ul";renderCount=1/0;constructor(e,...t){super(),this.itemRender=e,this.list(...t),this.render.list=this.updateList}list=(...e)=>c.call(this,"list",...e);updateList=()=>{const{children:e,list:t}=this.props;if(t.length){if(!this.element.parentNode)return;if(Rope.detective.dispatch(this,{props:{list:!0}}),this.templateElement?.parentNode&&(this.templateElement.parentNode.insertBefore(this.element,this.templateElement),this.templateElement.remove()),t.length>e.length){const s=e.length,n=t.slice(s);this.addListChildren(n,s)}}else if(this.parent){const e=this.templateElement||document.createComment("");this.templateElement=e,this.parent.element.insertBefore(e,this.element),this.element.remove()}};addListChildren=(e,t)=>{const{itemRender:s}=this;if(this.renderCount===1/0){const n=e.map(((e,n)=>{const r=n+t,i=s(e,r).show(this,"props.list",((e=[])=>r<e.length));return i.parent=this,this.props.children.push(i),i.element})),r=this.element.parentNode||this.templateElement.parentNode,i=this.element.parentNode?this.element:this.templateElement,a=this.element.cloneNode();return a.append(...n),r.insertBefore(a,i),this.element.remove(),void(this.element=a)}};setRenderCount=e=>(this.renderCount=e,this)}class d extends a{type="input";constructor(...e){super(),this.value(...e)}value=c.bind(this,"value")}class m extends a{type="span";constructor(...e){super(),this.value(...e)}value=c.bind(this,"value")}class b extends a{type="img";constructor(...e){super(),this.src(...e)}src=c.bind(this,"src")}class g extends a{type="a";constructor(...e){super(),this.href(...e)}href=c.bind(this,"href");value=c.bind(this,"value")}const k=(...e)=>e instanceof Array&&!(e[1]instanceof Array)?new u(...e):new u(e[0]),y=(...e)=>h({args:[...e],Type:m}),f=(...e)=>h({args:[...e],Type:d}),E=(...e)=>h({args:[...e],Type:b}),C=(...e)=>h({args:[...e],Type:g}),v=(...e)=>h({args:[...e],Type:p}),T=a,w=new n,M=new class{memo=new Map;registe=(e,t,s,n)=>{const r=this.memo.get(e);if(r){const e=r.get(n);if(e)e[s]=t;else{const e=Object.create(null);e[s]=t,r.set(n,e)}}else{const r=new Map;this.memo.set(e,r);const i=Object.create(null);i[s]=t,r.set(n,i)}};dispatch=(e,t,s)=>{const n=this.memo.get(e);n&&n.forEach(((e,n)=>{Object.keys(e).find((s=>void 0!==Rope.Element.VElement.getPropsSafe(t,e[s])))&&n.update(e,s)}))}};class x{static renderTask=w;static detective=M;static Element=Object.create(null);constructor(e){x.renderTask.setMaxRenderCount(e)}}Object.assign(x.Element,t),(globalThis||window||GLOBAL).Rope=x;const A=x,{special:j,VElement:_}=Rope.Element;class L extends _{type="tr";dynamicProps=["value"];constructor(...e){super(),e&&e[0]?.type&&this.children(e)}value=j.bind(this,"value")}class O extends _{type="td";dynamicProps=["value"];constructor(...e){super(),e&&e[0]?.type&&this.children(e)}value=j.bind(this,"value")}const P=(...e)=>new O(...e),{hooks:S}=Rope.Element,N={state:{list:[],selected:null},props:{}},R=S(((e,t,s)=>s),N.state)(N.props),{div:q,text:F}=Rope.Element,I=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],V=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],B=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];let D=1;function $(e){const t=new Array(e);for(let s=0;s<e;s++)t[s]={id:D++,label:`${I[z(I.length)]} ${V[z(V.length)]} ${B[z(B.length)]}`};return t}function z(e){return Math.round(1e3*Math.random())%e}const H=({id:e})=>q(F(e).class("btn btn-primary btn-block").setElement(document.createElement("button")).id(e).onClick((()=>(e=>{switch(e){case"run":R({list:$(1e3)});break;case"runlots":R({list:$(1e4)});break;case"add":R({list:N.state.list.concat($(1e3))});break;case"update":{const e=N.state.list.slice(0);for(let t=0;t<e.length;t+=10){const s=e[t];e[t]={id:s.id,label:s.label+" !!!"}}R({list:e});break}case"clear":R({list:[]});break;case"swaprows":{const{list:e}=N.state;R({list:[e[0],e[998],...e.slice(2,998),e[1],e[999]]});break}}})(e)))).class("col-sm-6 smallpad"),U=q(H({id:"run"}),H({id:"runlots"}),H({id:"add"}),H({id:"update"}),H({id:"clear"}),H({id:"swaprows"})).class("row");U.update(),document.querySelector("#button-container").appendChild(U.element);const{text:G,link:J,list:K}=A.Element,Q=K(((e,t)=>((...e)=>new L(...e))(P().class("col-md-1").value(N.state,`list.${t}.id`),P(J("").value(N.state,`list.${t}.label`).onClick((()=>{return e=N.state.list[t].id,void R({selected:e});var e}))).class("col-md-4"),P(J("").children([G("").class("glyphicon glyphicon-remove")]).onClick((()=>(e=>{N.state.list.splice(e,1),R(N.state)})(t)))).class("col-md-1"),P().class("col-md-6")).class(N.state,"selected",(e=>{const s=N.state.list[t];return s&&s.id===e?"danger":""}))),N.state,"list").setElement(document.createElement("tbody"));Q.update(),document.querySelector("#list-container").appendChild(Q.element)})();