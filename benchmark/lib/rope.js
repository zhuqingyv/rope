(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Div:()=>u,Img:()=>g,Input:()=>d,Link:()=>b,List:()=>p,Text:()=>m,VElement:()=>C,div:()=>f,hooks:()=>o,img:()=>v,input:()=>y,link:()=>E,list:()=>T,setProps:()=>c,special:()=>h,text:()=>k});class s{isRunning=!1;event=new class{eventHub={};constructor(t){this.context=t}on=(t,e)=>{const s=this.eventHub[t];s&&s instanceof Array?s.push(e):this.eventHub[t]=[e]};emit=(t,...e)=>{const s=this.eventHub[t];s&&s instanceof Array&&s.forEach((t=>{t(...e)}))};remove=(t,e)=>{if(void 0!==t&&null!=t)if(e){const s=this.eventHub[t];s.find(((t,n)=>t===e&&(s.splice(n,1),!0)))}else delete this.eventHub[t]};destroy=()=>{this.eventHub=Object.create(null)}};_renderMaxCount=1/0;promise=null;taskMap=new Map;child=null;constructor(t,e){this.setMaxRenderCount(t),e instanceof Map?this.taskMap=e:e instanceof Array&&(this.taskMap=new Map(e))}add=(t,e,n,i)=>{if(this.isRunning)return this.child||(this.child=new s(this.renderMaxCount),this.child.parent=this),void this.child.add(t,e,n,((...t)=>{i(...t)}));{const s=this.taskMap.get(e);s?this.mergeContextTask(s,n):this.setContextTask({context:e,callback:i,task:t,updateObject:n}),this.start()}};mergeContextTask=(t,e)=>{e&&t.updateObject!==e&&t.updateObject&&Object.assign(t.updateObject,e)};setContextTask=({context:t,callback:e,task:s,updateObject:n})=>{e?this.taskMap.set(t,{callback:e,task:s,updateObject:n}):this.taskMap.set(t,s)};start=()=>{this.promise||(queueMicrotask((()=>{this.isRunning=!0;const{renderMaxCount:t}=this;if(t===1/0){const{taskMap:t}=this,e=[...t];this.runTaskList(e.reverse()).then((t=>{this.isRunning=!1,this.event.emit("onTaskFinished",t)})).catch((()=>this.isRunning=!1)),this.promise=null,this.clear()}else this.runTaskCount()})),this.promise=!0)};runTaskCount=()=>{const t=Array.from(this.taskMap),e=t.length;if(!this.taskMap.size)return;const s=t=>{const{renderMaxCount:n}=this,i=t.slice(0,n).reverse();this.runTaskList(i).then((()=>{if(n<t.length){const e=t.slice(n);this.event.emit("onTaskUpdate",t.length,e.length),setTimeout((()=>s(e)))}else this.event.emit("onTaskUpdate",t.length,0),this.event.emit("onTaskFinished",e),this.isRunning=!1,this.promise=null,this.clear()}))};s(t)};runTaskList=(t=[])=>{const e=Date.now();return new Promise(((s,n)=>{try{const n=t.length;for(let e=n-1;e>=0;e--){const s=t[e],[,n]=s;if(n instanceof Function)n();else{const{callback:t,updateObject:e,task:s}=n;s(e),t instanceof Function&&t()}}s([n,Date.now()-e])}catch(t){return n(t)}}))};setMaxRenderCount=t=>{if(!t)return;const e=Number(t);isNaN(e)||(this.renderMaxCount=e)};onTaskFinished=t=>{!t instanceof Function||this.event.on("onTaskFinished",t)};onTaskUpdate=t=>{!t instanceof Function||this.event.on("onTaskUpdate",t)};destroy=()=>{this.parent&&(this.parent.child=null),this.parent=null};clear=()=>{this.taskMap.clear(),this.destroy()};get renderMaxCount(){return this.parent?this.parent.renderMaxCount:this._renderMaxCount}set renderMaxCount(t){if(this.parent)return this.parent.renderMaxCount=t;this._renderMaxCount=t}}const n=s,i={};class r{static EVENT={onClick:"onclick",onInput:"oninput",onChange:"onchange"};static getPropsSafe=(t,e,s)=>{try{const n=e.split(".").reduce(((t,e)=>t[e]),t);return void 0===n?n===s?n:s:n}catch{return s}};static setAttribute=function(t,...e){const s=[...e],n=s.length;1===n&&void 0!==s[0]&&(this.props[t]=s[0]),n>=2&&this.bind(...s,this.props,t,s[2])};_el=null;_templateElement=null;_parent=null;_render=null;mountedCallback=null;updatedCallback=null;tempElement=null;updateTask=null;type=null;props={children:[],style:{}};events={};dynamicProps=[];children=t=>(t?.length&&t.forEach((t=>{t&&(t instanceof r||t.vm)&&(t.parent=this,this.props.children.push(t),t.update())})),this);className=(...t)=>(this.setAttribute("className",...t),this);class=this.className;dispose=(...t)=>(this.setAttribute("dispose",...t),this);id=(...t)=>(this.setAttribute("id",...t),this);style=(...t)=>(this.setAttribute("style",...t),this);key=(...t)=>(this.setAttribute("key",...t),this);show=(...t)=>(this.setAttribute("show",...t),this);setAttribute=r.setAttribute.bind(this);bind=(...t)=>{const e=[...t],s=(t,e,s,n,i)=>{Rope.detective.registe(t,e,n,this),Object.defineProperty(s,n,{get(){const s=r.getPropsSafe(t,e);return i instanceof Function?i(s):s}})};if(5===e.length){const[t,n,i,r,a]=e;s(t,n,i,r,a)}if(6===e.length){const[t,n,i,r,a,l]=e;s(t,n,r,a,l)}};onClick=t=>(this.element[r.EVENT.onClick]=t,this);onInput=t=>(this.element[r.EVENT.onInput]=t,this);onChange=t=>(this.element[r.EVENT.onChange]=t,this);onMounted=t=>(this.mountedCallback=t,this);onUpdated=t=>(this.updatedCallback=t,this);onEvent=(t,e)=>t&&e?(this.element[t]=e,this):this;update=(t,e)=>{if(this.renderTask)return this.renderTask;this.renderTask=new Promise((s=>{Rope.renderTask.add(this.render.render,this,t,(()=>{this.renderTask=null,e instanceof Function&&e(),this.updatedCallback instanceof Function&&this.updatedCallback(this),s()}))}))};dom=(t=(()=>null))=>(t(this.element,!!this.element.parentElement),this);setElement=t=>(t instanceof HTMLElement&&(this.element=t),this);get templateElement(){return this._templateElement||(this._templateElement=document.createElement("template")),this._templateElement}set templateElement(t){this._templateElement=t}get element(){return this._el||(this._el=document.createElement(this.type)),this._el}set element(t){return this._el=t}get parent(){return this._parent}set parent(t){this._parent=t}get render(){return this._render||(this._render=new class{target=null;dynamicProps=["dispose","show","key","className","id","style"];renderedAttributes=[];sort=Object.create(null);constructor(t,e=[]){this.target=t,this.dynamicProps.push(...e),this.initRenderSort()}initRenderSort=()=>{this.dynamicProps.forEach(((t,e)=>{this.sort[t]=e}))};render=t=>{const e=t?this.objectToList(t):this.dynamicProps;this.__render(e),this.renderedAttributes?.length&&(this.__render(this.renderedAttributes),this.renderedAttributes=[])};objectToList=t=>{const e=[];return Object.keys(t).forEach((t=>{const s=this.sort[t];e[s]=t})),e};__render=t=>{if(t?.length){let e=null;t.find(((t,s)=>{const n=this[t];return!(!n||!1!==n()||(e=s,0))}))&&(this.renderedAttributes=t.slice(e+1))}};dispose=()=>{const{dispose:t}=this.props;return!(t||this.parent?.props.dispose)||(this.clearElement(),this.clearState(),!1)};show=()=>{const{show:t}=this.props;return!1===t?(this.resumeTemplate(),!1):(this.resumeElement(),!0)};key=()=>{const{key:t}=this.props,{element:e}=this;return e&&void 0!==t&&null!=t&&(i[t]=e),!0};className=()=>{const{className:t}=this.props;return this.setStringAttribute("class",t),!0};id=()=>{const{id:t}=this.props;return this.setStringAttribute("id",t),!0};style=()=>{const{element:t}=this,{style:e}=this.props;return Object.entries(e).forEach((e=>{const[s,n]=e;t.style[s]!==n&&(t.style[s]=n)})),!0};src=()=>{const{src:t}=this.props;return this.setStringAttribute("src",t),!0};href=()=>{const{href:t}=this.props;return this.setStringAttribute("href",t),!0};value=()=>{const{value:t}=this.props;if(null==t)return!0;const e=String(t),s="input"===this.type?"value":"innerHTML";return this.element[s]!==e&&(this.element[s]=e),!0};buildElement=()=>(this.element||(this.element=document.createElement(this.type)),this.tempElement||(this.tempElement=document.createElement("template")),!0);resumeTemplate=()=>{const{templateElement:t,element:e,parent:s}=this,n=s.element;return!n||(t.parentElement||e.parentElement||!n||s.element.appendChild(t),e.parentElement&&!t.parentElement&&e.parentElement.insertBefore(t,e),e.remove(),!0)};resumeElement=()=>{const{templateElement:t,element:e,parent:s}=this;return!s||t.parentElement||e.parentElement?t.parentElement&&!e.parentElement?(t.parentElement.insertBefore(e,t),this.mountedCallback instanceof Function&&this.mountedCallback(this.target),!0):(!e.parentElement&&s?.element&&(s.element.appendChild(e),this.mountedCallback instanceof Function&&this.mountedCallback(this.target)),!0):(s.element.appendChild(e),this.mountedCallback instanceof Function&&this.mountedCallback(this.target),!0)};removeAllElement=()=>{const{element:t,templateElement:e}=this;return t&&t.remove(),e&&e.remove(),!0};clearAllElement=()=>(this.removeElement(),this.element=null,this.templateElement=null,!0);clearElement=()=>(this.resumeTemplate(),this.element=null,!0);clearState=()=>{this.hook.clearState()};setStringAttribute=(t,e)=>{const{element:s}=this;if(!s||null==t||"string"!=typeof t)return;const n=s.getAttribute(t);if(null!=e&&""!==e){const i=String(e);n!==i&&s.setAttribute(t,i)}else n&&s.removeAttribute(t)};get element(){return this.target.element}set element(t){this.target.element=t}get templateElement(){return this.target.templateElement}set templateElement(t){this.target.templateElement=t}get hook(){return this.target.hook}get props(){return this.target.props}get parent(){return this.target.parent}get type(){return this.target.type}get mountedCallback(){return this.target.mountedCallback}}(this,this.dynamicProps)),this._render}}const a=r;class l{type="hook";constructor(t,e){this.state=t,this.vm=e,e.hook=this}clearState=()=>{for(let t in this.state)delete this.state[t]};get element(){return this.vm.element}get props(){return this.vm.props}}const o=(t,e)=>{let s=(t=>t instanceof Function?t()||Object.create(null):null==t?{}:t)(e),n={},i=null;return(...e)=>{let r="normal",a={};const o=[...e];1!==o.length||o[0]?.vm||(a=o[0]);const[h,c]=o;"object"==typeof h&&"string"==typeof c&&(r="dynamic");const u=(t,e)=>new Promise(((r,a)=>{try{if(!t&&"object"==typeof t)return a("changeState is not defined!");if(Object.assign(n,t),i)return;i=!0,queueMicrotask((()=>{Object.assign(s,n),Rope.detective.dispatch(s,n,((...t)=>{e&&e instanceof Function&&e(...t),r()})),i=null,n={}}))}catch(t){a(t)}}));let p;switch(r){case"normal":p=t(a,s,u);break;case"dynamic":p=t(...e,s,u)}return new l(s,p),p}},h=function(t,...e){return this.setAttribute(t,...e),this.update(),this},c=({args:t,Type:e})=>{const s=t,n=s.length;if(3===n){const[t,n,i]=s;return new e(t,n,i)}if(2===n){const[t,n]=s;return new e(t,n)}if(1===n){const[t]=s;return new e(t)}};class u extends a{type="dev";dynamicProps=["value"];constructor(...t){super(),t[0]?.type&&this.children(t)}value=h.bind(this,"value")}class p extends a{itemRender=null;type="ul";dynamicProps=["list"];constructor(t,...e){super(),this.itemRender=t,this.list(...e),this.render.list=this.updateList}list=(...t)=>h.call(this,"list",...t);updateList=()=>{const{children:t,list:e}=this.props;if(e.length>t.length){const s=t.length,n=e.slice(s);this.addListChildren(n,s)}Rope.detective.dispatch(this,{props:{list:!0}})};addListChildren=(t,e)=>{const{itemRender:s}=this,n=t.map(((t,n)=>{const i=n+e;return s(t,i).show(this,"props.list",(t=>!!t[i]))}));this.children(n,!1)}}class d extends a{type="input";dynamicProps=["value"];constructor(...t){super(),this.value(...t)}value=h.bind(this,"value")}class m extends a{type="span";dynamicProps=["value"];constructor(...t){super(),this.value(...t)}value=h.bind(this,"value")}class g extends a{type="img";dynamicProps=["src"];constructor(...t){super(),this.src(...t)}src=h.bind(this,"src")}class b extends a{type="a";dynamicProps=["href","value"];constructor(...t){super(),this.href(...t)}href=h.bind(this,"href");value=h.bind(this,"value")}const f=(...t)=>t instanceof Array&&!(t[1]instanceof Array)?new u(...t):new u(t[0]),k=(...t)=>c({args:[...t],Type:m}),y=(...t)=>c({args:[...t],Type:d}),v=(...t)=>c({args:[...t],Type:g}),E=(...t)=>c({args:[...t],Type:b}),T=(...t)=>c({args:[...t],Type:p}),C=a,M=new n,A=new class{memo=new Map;registe=(t,e,s,n)=>{const i=this.memo.get(t);if(i){const t=i.get(n);if(t)t[s]=e;else{const t=Object.create(null);t[s]=e,i.set(n,t)}}else{const i=new Map;this.memo.set(t,i);const r=Object.create(null);r[s]=e,i.set(n,r)}};dispatch=(t,e,s)=>{const n=this.memo.get(t);n&&n.forEach(((t,n)=>{Object.keys(t).find((s=>void 0!==Rope.Element.VElement.getPropsSafe(e,t[s])))&&n.update(t,s)}))}};class j{static renderTask=M;static detective=A;static Element=Object.create(null);constructor(t){j.renderTask.setMaxRenderCount(t)}}Object.assign(j.Element,e),globalThis.Rope=j})();